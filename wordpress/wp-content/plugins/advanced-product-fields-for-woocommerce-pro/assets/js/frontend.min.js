var WAPF;!function(e){var t=(a.prototype.dependencies=function(t){t.on("keyup change",'.wapf-input,input[name="variation_id"]',function(){e.Util.doDependencies(t)}),e.Util.doDependencies(t)},a.prototype.quantity=function(t){var a=t.find("[data-qty-based]");a.length&&(t.on("change",":input.qty",function(){e.Util.doQtyLogic(t,a)}),e.Util.doQtyLogic(t,a))},a.prototype.productImage=function(t,a){function i(){setTimeout(function(){jQuery(window).trigger("resize"),t.find(".images").trigger("woocommerce_gallery_init_zoom")},15)}function r(e){setTimeout(function(){var r,n,c=a[parseInt(e)],f=t.find("[data-wapf-att-id="+e+"]");if(f.length&&wapf_config.slider_support){var l=t.find(".images").data("flexslider");if(l){var s=l.vars?l.vars.animationSpeed:250;return u&&(l.vars.animationSpeed=0),t.find(".flex-control-nav li").eq(jQuery("[data-wapf-att-id]").index(f)).find("img").trigger("click"),l.vars.animationSpeed=s,u=!1,i()}}r=c,p=t.find(".images .wp-post-image").eq(0),d.forEach(function(e){r[e]&&p.attr(e,r[e])}),r.srcset||p.attr("srcset",""),Object.keys(o).forEach(function(e){p.attr(e,r[o[e]])}),(n=t.find(".flex-control-nav li").eq(0).find("img")).attr("src",r.thumb_src),p.closest("a").attr("href",r.full_src),p.closest("div").attr("data-wapf-att-id",r.image_id),n.trigger("click"),i()},0)}function n(a,i,n){(n=function(a,i,r){for(var n=0;n<r.length;n++){for(var c=r[n],f=!0,l=0;l<c.values.length;l++){var d=c.values[l];if("*"!=d.value){var o=t.find("[data-field-id="+d.field+"]");if(!(Array.isArray(o=e.Util.getFieldValue(o,!0))?-1<o.indexOf(d.value):d.value==o||o&&"true"==d.value)||"last"===a&&d.field!=i.data("field-id")){f=!1;break}}}if(f)return c}return null}(a=void 0===a?"rules":a,i,n=void 0===n?[]:n))?r(n.image):r((n=e.Util.selectedVariation(t))?n.image_id:g)}var c,f,l,d=["src","height","width","title","srcset","alt","sizes"],o={"data-src":"full_src","data-caption":"caption","data-large_image":"full_src","data-large_image_width":"full_src_w","data-large_image_height":"full_src_h"},u=!0,p=t.find(".images .wp-post-image"),s=t.find("[data-wapf-gi]"),g=null;p.length&&s.length&&(jQuery(document).trigger("wapf:delete_var"),g=p.closest("div").data("wapf-att-id"),t.find("[data-wapf-att-id]").each(function(e,t){var i,r,n,c=jQuery(t);a[t=c.data("wapf-att-id")]||(a[t]=(i={image_id:c.attr("data-wapf-att-id")},n=(r=c.find("img")).data("o_src")?"data-o_":"",d.forEach(function(e){i[e]=r.attr(n+e)}),i.thumb_src=c.data("thumb"),Object.keys(o).forEach(function(e){i[o[e]]=r.attr(n+e)}),wapf_config.slider_support||(i.srcset=" "),i))}),!(c=t.find('input[name="variation_id"]')).length||(f=t.find("form.cart").data("product_variations"))&&f.forEach(function(e){e.image.image_id=e.image_id,a[e.image_id]=e.image}),l=[],s.each(function(e,t){var i=jQuery(t),r=(t=i.data("wapf-gi"),i.data("group"));l[r]=t.rules.reverse(),t.images.forEach(function(e){a[e.image_id]=e}),i.find(".wapf-input").on("change",function(e){n(i.data("wapf-st"),jQuery(e.currentTarget),l[r])}).filter(":visible").eq(0).trigger("change")}),c.on("change",function(){n("rules",c)}))},a);function a(t){t.data("wapf-iid",Math.random().toString(36).substr(2,6)),this.dependencies(t),new e.Pricing(t),this.quantity(t);var a={};function i(){t.find(".wapf-checkboxes[data-is-required=1],.wapf-swatch-wrapper[data-is-required=1]").each(function(e,t){var a=jQuery(t).find('input[type="checkbox"]');t=function(){a.filter(":checked").length?a.not(":checked").prop("required",!1):a.first().prop("required",!0)},a.off("change",t).on("change",t),t(),jQuery(document).on("wapf/dependencies",t)})}this.productImage(t,a),e.Util.varsViaAjax(t)&&jQuery(document).on("found_variation",function(i,r){e.Util.selectedVar=r,e.Util.doDependencies(t),a[r.variation_id]=r,e.Pricing.calculateAll(t)}),t.on("click",".wapf-swatch",function(){var e,t,a,i,r=jQuery(this),n=r.find(".wapf-input");n.is(":disabled")||(e="wapf-checked",t="1"==n.data("is-required"),a=r.closest(".wapf-swatch-wrapper").find(".wapf-swatch"),i=function(){r.toggleClass(e),n.prop("checked",!n.prop("checked")).trigger("change")},n.is(":radio")?t?(a.removeClass(e),n.prop("checked",!0).trigger("change"),r.addClass(e)):(a.not(r).removeClass(e),i()):i())}),t.on("change","input[type=checkbox]",function(){var e,t,a=jQuery(this),i=a.data("maxc"),r=a.data("minc");(r||i)&&(e=(t=a.closest(".wapf-field-container").find("input[type=checkbox]")).filter("input:checked").length,t=t.not(":checked"),i&&t.prop("disabled",i<=e),r&&t.prop("required",!(!a.data("is-required")&&!e)&&e<r))}),t.on("change",".wapf-checkable input",function(){var e=jQuery(this);e.is(":radio")&&e.closest(".wapf-field-input").find(".wapf-checkable").removeClass("wapf-checked"),e.closest(".wapf-checkable").toggleClass("wapf-checked")}),i(),jQuery(document).on("wapf/cloned",i),jQuery("body").on("adding_to_cart",function(e,t,a){return"object"!=typeof a?a:-1<Object.keys(a).indexOf("wapf_field_groups")?a:(t=t.closest("form.cart").find(".wapf-wrapper :input").serializeArray())?void t.forEach(function(e){var t;-1<e.name.indexOf("[]")?(a[t=e.name.replace("[]","")]||(a[t]=[]),a[t].push(e.value)):a[e.name]=e.value}):a}),jQuery(document).trigger("wapf/init",[t])}e.Frontend=t}(WAPF=WAPF||{}),jQuery(function(e){"product"==wapf_config.page_type?new WAPF.Frontend(e("body")):e("[data-product-page-preselected-id]").each(function(t,a){new WAPF.Frontend(e(a))})}),function(e){var t=(a.fxPriceHints=function(t,a,i){i=e.Filter.apply("wapf/fx/hint",i);var r=e.Util.formatMoney(i,wapf_config.display_options);r=e.Filter.apply("wapf/html/fxhint",(i<0?"":"+")+r),a.is("option")&&a.data("fx-hint")&&a.html(a.data("wapf-label")+" "+a.data("fx-hint").replace(/\.{3}/,r)),a.closest(".has-pricing").find(".wapf-addon-price").html(r)},a.calculateAll=function(t){var a=wapf_config.display_options,i=e.Util.currentProductPrice(t)*e.Util.getQty(t),r=this.calculateOptionTotal(t),n=i+r;n<0&&(n=0);var c=".wapf-",f=e.Util.formatMoney;t.find(c+"product-total").html(f(i,a)),t.find(c+"options-total").html(f(r,a)),t.find(c+"grand-total").html(f(n,a)),t.find(c+"product-totals").show(),jQuery(document).trigger("wapf/pricing",[i,r,i+r,t])},a.calculateOptionTotal=function(t){var i=0;return t.find("[data-wapf-price]").each(function(r,n){var c=jQuery(n),f=e.Util.getFieldType(c);n=null,"fx"===c.data("wapf-pricetype")&&(n=a.getPrice(t,c,i),a.fxPriceHints(t,c,n)),!0!==c.prop("disabled")&&(-1<["checkbox","radio"].indexOf(f)&&!c.is(":checked")||("option"!=f||c.is(":selected")&&!0!==c.closest("select").prop("disabled"))&&c.val()&&(i+=null!==n?n:a.getPrice(t,c,i)))}),i},a.getPrice=function(t,a,i){void 0===i&&(i=0);var r=e.Util.currentProductPrice(t),n=a.data("wapf-pricetype"),c=a.data("wapf-price"),f=a.data("wapf-label")||a.val(),l=e.Util.getQty(t);return l=this.toAdd(n,r,"fx"===n?c:parseFloat(c||"0"),t,a,f,i/l),"fx"===n&&c.indexOf("[price]"),l||0},a.toAdd=function(t,a,i,r,n,c,f){var l=e.Util.getQty(r);switch(t){case"percent":case"p":return a*(i/100);case"qt":return l*i;case"nr":case"nrq":return c*i;case"char":return c.length*i;case"charq":return c.length*i*l;case"fx":var d=e.Util.replaceFx(i,l,a,c,r,f);return d=e.Util.evalVars(this.variables,d,c,l,a,n,r,f),e.Util.parseFx(d,r);default:return i}},a.variables=[],a);function a(e){var t;e.find("[data-wapf-price]").length&&(t=e.data("wapf-iid"),a.variables[t]=[],e.find(".wapf-field-group").each(function(e,i){(i=jQuery(i).data("variables"))&&(a.variables[t]=a.variables[t].concat(i))}),e.on("keyup change",'.wapf-input,input[name="variation_id"]',function(){a.calculateAll(e)}),e.find("[data-qty-based]").length||e.on("keyup change",":input.qty",function(){a.calculateAll(e)}),a.calculateAll(e))}e.Pricing=t}(WAPF),function(e){var t=(a.add=function(e,t){this.f[e]||(this.f[e]=[]),this.f[e].push(t)},a.apply=function(e,t,a){return this.f[e]&&this.f[e].forEach(function(e){t=e(t,a)}),t},a.f=[],a);function a(){}e.Filter=t}(WAPF),function(e){var t=(a.first=function(e,t,a){for(var i=0;i<e.length;i++)if(e[i][t]===a)return e[i];return null},a.replaceFx=function(t,i,r,n,c,f){return void 0===f&&(f=0),t=t.replace(/\[qty]/g,i).replace(/\[price]/g,r).replace(/\[x]/g,n).replace(/\[options_total]/g,f),e.Filter.apply("fx/replace",t.replace(/\[field\..+?]/g,function(e){return a.getFieldValue(c.find(".wapf-input[data-field-id="+e.replace("[field.","").replace("]","")+"]"))}),{qty:i,base:r,value:n,$parent:c})},a.parseFx=function(t,i,r){return void 0===i&&(i=null),void 0===r&&(r=!0),e.Filter.apply("wapf/fx/functions",Object.keys(a.formulas)).forEach(function(r){for(var n,c=r+"(";-1<(n=(""+t).indexOf(c));){var f=function(e,t){for(var a=1,i=0,r=t;r<e.length;r++)if("("==e[r]&&a++,")"==e[r]&&a===++i)return r;return t}(t,d=n+c.length),l=function(e){for(var t=0,a="",i=[],r=0;r<e.length;r++)";"!=e[r]||t?("("==e[r]&&t++,")"==e[r]&&t--,a+=e[r]):(i.push(a.trim()),a="");return!a.length&&i.length||i.push(a.trim()),i}(t.substring(d,f)),d=a.formulas[r]?a.formulas[r](l,i):"";t=e.Filter.apply("wapf/fx/solve",t.substr(0,n)+d+t.substr(f+1),{func:r,args:l,$parent:i})}}),a.evalFx(t),r?a.evalFx(t):t},a.evalFx=function(e,t){if(void 0===t&&(t=!0),!e)return 0;function a(e){return parseFloat(e)}function i(e,t){return -1<e.indexOf(t)}var r=function(e){var n=!1,c=!1,f=0;if(t&&(e=(""+e).replace(/[^\d.+\-*\/()]/gi,"")),i(e,"(")&&i(e,")")){var l=/\(([\d.+\-*\/]+)\)/;if(1<(d=e.match(l)||[]).length)return r(e.replace(l,r(d[1])))}if(i(e=e.replace("(","").replace(")",""),"/")||i(e,"*")){n=!0;for(var d,o=["/","*"];o.length;)for(var u=o.pop();u&&i(e,u);){if(l=RegExp("([\\d.]+)\\"+u+"(\\-?[\\d.]+)"),!(2<(d=e.match(l)||[]).length))return 0;"+"==u&&(f=a(d[1])+a(d[2])),"-"==u&&(f=a(d[1])-a(d[2])),"*"==u&&(f=a(d[1])*a(d[2])),"/"==u&&(f=a(d[1])/a(d[2])),e=(e=e.replace(l,f)).replace("-+","-")}}if(i(e,"+")||i(e,"-")){c=!0;var p=(e=e.replace("--","+")).match(/([\d.]+|[+\-])/g)||[];if(0<p.length){f=0,u="+";for(var s=0;s<p.length;s++)"+"==p[s]||"-"==p[s]?u=p[s]:f="+"==u?f+a(p[s]):f-a(p[s])}}return n||c?f:a(e)};return r(e)+-.02},a.cloneField=function(e,t,a){return a&&(t=t.find('[for="'+e+'"]').first()).length&&""==t.data("qty-based")?e+"_clone_"+a:e},a.cloneFx=function(e,t,i){return i?e.replace(/\[(field\.)(.+?)]/g,function(e,r,n){return"["+r+a.cloneField(n,t,i)+"]"}):e},a.evalVars=function(e,t,i,r,n,c,f,l){return t.replace(/\[var_.+?]/g,function(t){var l=f.data("wapf-iid");if(e[l]){var d=a.first(e[l],"name",t.replace(/\[var_|]/g,""));if(d){for(var o=d.default,u=c.data("clone")||0,p=0;p<d.rules.length;p++){var s=d.rules[p],g=a.cloneField(s.field,f,u);if(a.isValidRule(f,g,s.condition,s.value||"")){o=s.variable;break}}return a.parseFx(a.replaceFx(a.cloneFx(o,f,u),r,n,i,f,0),f)+.1}}return 0})},a.getFieldType=function(e){if(e.is("input"))return e.data("df")?"date":e.data("is-file")?"file":e.attr("type");for(var t=["select","textarea","option"],a=0;a<t.length;a++)if(e.is(t[a]))return t[a];return""},a.getFieldValue=function(e,t){void 0===t&&(t=!1);var i=a.getFieldType(e),r=e.attr("name"),n=jQuery('input[name="'+r+'"]:checked');switch(i){case"select":var c=e.val();return t?c||"":c?e.find("option:selected").data("wapf-label"):"";case"radio":return c=n.val(),t?c||"":n.length?n.data("wapf-label"):"";case"checkbox":if("[]"!=r.substring(r.length-2,r.length))return e.is(":checked");var f=[];return n.each(function(e,a){a=jQuery(a),f.push(t?a.val():a.data("wapf-label"))}),f;default:return e.val()}},a.getQty=function(e){return(e=e.find("[name=quantity]")).length?parseInt(e.val()||1):1},a.currentProductType=function(e){return e.find(".wapf-product-totals").data("product-type")},a.currentProductPrice=function(t){var i=a.selectedVariation(t),r="variable"==a.currentProductType(t)?i?i.display_price:0:t.find(".wapf-product-totals").data("product-price");return e.Filter.apply("wapf/pricing/base",r+.1,{parent:t})},a.currentVariationId=function(e){return(e=e.find('input[name="variation_id"]').val())?parseInt(e):0},a.varsViaAjax=function(e){return 0==e.find("[data-product_variations]").data("product_variations")},a.selectedVariation=function(e){var t=e.find("[data-product_variations]").data("product_variations");return t?(e=a.currentVariationId(e))?a.first(t,"variation_id",e):null:a.selectedVar},a.unformat=function(e,t){if(void 0===t&&(t=","),"number"==typeof e)return e;var a=RegExp("[^0-9-"+t+"]","g");return t=parseFloat(e.replace(/\((.*)\)/,"-$1").replace(a,"").replace(t,".")),isNaN(t)?0:t},a.formatNumber=function(e,t,i,r){var n,c,f=Number(Math.round((n=Math.abs(e=a.unformat(e,r)))+"e"+c)+"e-"+(c=t)).toFixed(c),l=e<0?"-":"",d=parseInt(f,10)+"";return l+((e=3<d.length?d.length%3:0)?d.substr(0,e)+i:"")+d.substr(e).replace(/(\d{3})(?=\d)/g,"$1"+i)+(t?r+f.split(".")[1]:"")},a.formatMoney=function(e,t){return e<0&&t.format.replace("%2$s","-%2$s"),t.format.replace("%1$s",t.symbol).replace("%2$s",a.formatNumber(e,t.decimals||0,t.thousand,t.decimal))},a.isValidRule=function(e,t,i,r){var n=null;if("qty"==t)n=a.getQty(e);else{var c=e.find('[data-field-id="'+t+'"]').first();if(!c.length)return!1;if(-1<i.indexOf("product_var")||-1<i.indexOf("patts")){if(-1===(t=a.currentProductType(e)).indexOf("variable")&&-1===t.indexOf("variation"))return!0;var f=a.selectedVariation(e);if(null==f)return!1;function l(){for(var e=0;e<d.length;e++){var t=d[e].split("|");if(f.attributes&&f.attributes["attribute_pa_"+t[0]]&&("*"==t[1]||f.attributes["attribute_pa_"+t[0]]===t[1]))return!0}return!1}var d=r.split(","),o=""+f.variation_id;switch(i){case"product_var":return -1<d.indexOf(o);case"!product_var":return -1==d.indexOf(o);case"patts":return!0===l();case"!patts":return!1===l()}}if(c.closest(".wapf-field-container").hasClass("wapf-hide"))return!1;n=a.getFieldValue(c,!0),"date"===a.getFieldType(c)&&r&&(n=c.data("selected"),c=r.split("-"),r=new Date(parseInt(c[2]),parseInt(c[0])-1,parseInt(c[1])))}switch("number"==typeof n&&(n=n.toString()),i){case"check":return 1==n;case"!check":return 0==n;case"==":return Array.isArray(n)?-1<n.indexOf(r):n instanceof Date?n&&n.getTime()===r.getTime():n==r;case"!=":return Array.isArray(n)?-1==n.indexOf(r):n instanceof Date?n&&n.getTime()!=r.getTime():n!=r;case"empty":return n==[]||""==n;case"!empty":return n!=[]&&""!=n;case"==contains":return -1<n.indexOf(r);case"!=contains":return -1===n.indexOf(r);case"lt":return parseFloat(n)<=parseFloat(r);case"gt":return parseFloat(n)>=parseFloat(r);case"gtd":return n&&r.getTime()>n.getTime();case"ltd":return n&&r.getTime()<n.getTime()}return!1},a.doDependencies=function(e){var t="disabled",i=!1;e.find(".has-conditions").each(function(r,n){var c=jQuery(n),f=function t(i){var r=i.data("wapf-d");if(!Array.isArray(r))return!0;for(var n=0;n<r.length;n++)if(function(t){for(var i=0;i<t.length;i++)if(!a.isValidRule(e,t[i].field,t[i].condition,t[i].value||""))return!1;return!0}(r[n].rules))return!0;return!1}(c);n=c.hasClass("wapf-hide"),(f&&n||!f&&!n)&&(i=!0),c[(f?"remove":"add")+"Class"]("wapf-hide"),c.find(".wapf-tf-h").prop(t,!f),c.find(".wapf-input").each(function(e,a){(a=jQuery(a)).prop("required",!!f&&a.data("is-required")).prop(t,!f)})}),i&&jQuery(document).trigger("wapf/dependencies")},a.doQtyLogic=function(t,i){function r(e,i,r,n){function c(e){var a=e.data("wapf-d");a&&((a=JSON.parse(JSON.stringify(a))).forEach(function(e){e.rules.forEach(function(e){var a=t.find('[for="'+e.field+'"]').first();a.length&&(""==a.data("qty-based")||a.closest(".wapf-section[data-qty-based]").length)&&(e.field=e.field+"_clone_"+i)})}),e.attr("data-wapf-d",JSON.stringify(a)).data("wapf-d",a))}var f=e.find(".wapf-input,.wapf-tf-h").data("clone",i),l=e.find(".has-conditions");return c(e),l.each(function(e,t){c(jQuery(t))}),f.each(function(r,n){var c=jQuery(n),f=c.data(c.hasClass("wapf-tf-h")?"fid":"field-id"),l=f+"_clone_"+i;function d(e){var r;"fx"==e.data("wapf-pricetype")&&(r=a.cloneFx(e.data("wapf-price"),t,i),e.attr("data-wapf-price",r).data("wapf-price",r))}["name","id","data-field-id","data-fid"].forEach(function(e){c.attr(e)&&c.attr(e,c.attr(e).replace(f,l))}),c.data("field-id",l),d(c),c.find("option").data("clone",i).each(function(e,t){d(jQuery(t))});var o=c.attr("id");(n=e.find('label[for="'+o+'"]')).length&&(n.attr("for",o=o+"_"+i),c.attr("id",o))}),e.removeAttr("data-qty-based data-clone-txt"),f=e.find(".wapf-field-label label > span:first-child"),n||f.html(r),e}var n=a.getQty(t);i.each(function(e,t){var a=jQuery(t),i=a.data("dupe")||[],c=a.attr("for"),f=i.length,l=n-(f+1),d=a.hasClass("wapf-section");if(0!=l){if(0<l)for(var o=0;o<l;o++){var u=f+o+2,p=(a.data("clone-txt")||"").replace("{n}",u),s=r(a.clone(!0),u,p,d);s.insertAfter(i.length?i[i.length-1]:a),d&&p&&s.prepend('<div class="wapf-clone-title"><label>'+p+"</label></div>"),jQuery(document).trigger("wapf/cloned",[c,u,s]),i.push(s)}else i.splice(l,-1*l).forEach(function(e){e.remove()});a.data("dupe",i)}}),e.Pricing.calculateAll(t)},a.formulas={len:function(e){return""+e[0].length},min:function(e,t){return Math.min.apply(null,e.map(function(e){return a.parseFx(e,t)}))},max:function(e,t){return Math.max.apply(null,e.map(function(e){return a.parseFx(e,t)}))}},a.selectedVar=null,a);function a(){}e.Util=t}(WAPF);